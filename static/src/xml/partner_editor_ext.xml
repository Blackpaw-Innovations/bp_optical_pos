<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    
    <t t-name="point_of_sale.PartnerDetailsEdit" t-inherit="point_of_sale.PartnerDetailsEdit" t-inherit-mode="extension" owl="1">
        <!-- Hide standard fields for optical POS -->
        <xpath expr="//div[hasclass('partner-details-box')]" position="attributes">
            <attribute name="t-attf-class">partner-details-box {{opticalEnabled ? 'd-none' : ''}}</attribute>
        </xpath>
        
        <!-- Add streamlined optical patient fields -->
        <xpath expr="//div[hasclass('partner-details-box')]" position="after">
            <t t-if="opticalEnabled">
                <div class="optical-patient-form">
                    <!-- Basic Patient Info -->
                    <div class="row row-cols-1 row-cols-sm-2 gy-3">
                        <!-- Name (Required) -->
                        <div class="partner-detail col-12">
                            <label class="form-label label fw-bold" for="optical_name">Name *</label>
                            <input type="text" 
                                   class="detail form-control" 
                                   id="optical_name"
                                   name="name"
                                   t-model="changes.name"
                                   required="required"
                                   placeholder="Patient Name"/>
                        </div>
                        
                        <!-- Phone -->
                        <div class="partner-detail col">
                            <label class="form-label label" for="optical_phone">Phone</label>
                            <input type="tel" 
                                   class="detail form-control" 
                                   id="optical_phone"
                                   name="phone"
                                   t-model="changes.phone" 
                                   placeholder="Phone Number"/>
                        </div>
                        
                        <!-- Mobile -->
                        <div class="partner-detail col">
                            <label class="form-label label" for="optical_mobile">Mobile</label>
                            <input type="tel" 
                                   class="detail form-control" 
                                   id="optical_mobile"
                                   name="mobile"
                                   t-model="changes.mobile" 
                                   placeholder="Mobile Number"/>
                        </div>
                        
                        <!-- Email -->
                        <div class="partner-detail col">
                            <label class="form-label label" for="optical_email">Email</label>
                            <input type="email" 
                                   class="detail form-control" 
                                   id="optical_email"
                                   name="email"
                                   t-model="changes.email" 
                                   placeholder="Email Address"/>
                        </div>
                        
                        <!-- Date of Birth -->
                        <div class="partner-detail col">
                            <label class="form-label label" for="date_of_birth">Date of Birth</label>
                            <input type="date" 
                                   class="detail form-control" 
                                   id="date_of_birth"
                                   name="date_of_birth"
                                   t-model="changes.date_of_birth"/>
                        </div>
                        
                        <!-- Has Insurance Checkbox -->
                        <div class="partner-detail col-12 mt-3">
                            <div class="form-check">
                                <input type="checkbox" 
                                       class="form-check-input" 
                                       id="has_insurance"
                                       name="has_insurance"
                                       t-model="changes.has_insurance"
                                       t-on-change="onInsuranceCheckChange"/>
                                <label class="form-check-label" for="has_insurance">
                                    Has Insurance
                                </label>
                            </div>
                        </div>
                        
                        <!-- Add Insurance Button (shown when has_insurance is checked) -->
                        <div class="partner-detail col-12" t-if="changes.has_insurance">
                            <button type="button" 
                                    class="btn btn-primary w-100"
                                    t-on-click="openInsurancePopup">
                                <i class="fa fa-plus-circle me-2"/>Add Insurance Details
                            </button>
                            
                            <!-- Show insurance summary if filled -->
                            <div class="alert alert-info mt-2" t-if="hasInsuranceData">
                                <strong>Insurance:</strong> <t t-esc="getInsuranceSummary()"/>
                                <button type="button" 
                                        class="btn btn-sm btn-link float-end"
                                        t-on-click="openInsurancePopup">
                                    Edit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
    </t>
    
</templates>
